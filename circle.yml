dependencies:
  pre:
    - curl -sL https://github.com/apex/apex/releases/download/v0.5.1/apex_linux_386 -o tmp/apex
    - chmod +x tmp/apex
    - cd tmp; git clone https://github.com/awslabs/aws-apigateway-swagger-importer.git
    - cd tmp/aws-apigateway-swagger-importer; mvn assembly:assembly

deployment:
  production:
    branch: master
    commands:
      - tmp/apex deploy
      - tmp/aws-apigateway-swagger-importer/aws-api-import.sh --update $AWS_API_ID --deploy api ./api.yml
      - bundle exec middleman build
      - bundle exec middleman sync
      - bundle exec middleman invalidate
